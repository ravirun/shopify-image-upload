(()=>{var e={};e.id=355,e.ids=[355],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},9288:e=>{"use strict";e.exports=require("sharp")},9428:e=>{"use strict";e.exports=require("buffer")},9021:e=>{"use strict";e.exports=require("fs")},1630:e=>{"use strict";e.exports=require("http")},5591:e=>{"use strict";e.exports=require("https")},3873:e=>{"use strict";e.exports=require("path")},7910:e=>{"use strict";e.exports=require("stream")},9551:e=>{"use strict";e.exports=require("url")},8354:e=>{"use strict";e.exports=require("util")},3566:e=>{"use strict";e.exports=require("worker_threads")},4573:e=>{"use strict";e.exports=require("node:buffer")},3024:e=>{"use strict";e.exports=require("node:fs")},7067:e=>{"use strict";e.exports=require("node:http")},4708:e=>{"use strict";e.exports=require("node:https")},7030:e=>{"use strict";e.exports=require("node:net")},4379:e=>{"use strict";e.exports=require("node:path")},1708:e=>{"use strict";e.exports=require("node:process")},7075:e=>{"use strict";e.exports=require("node:stream")},7830:e=>{"use strict";e.exports=require("node:stream/web")},3136:e=>{"use strict";e.exports=require("node:url")},7975:e=>{"use strict";e.exports=require("node:util")},8522:e=>{"use strict";e.exports=require("node:zlib")},4604:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>P,routeModule:()=>q,serverHooks:()=>v,workAsyncStorage:()=>y,workUnitAsyncStorage:()=>w});var s={};t.r(s),t.d(s,{POST:()=>h});var o=t(2706),i=t(8203),a=t(5994),u=t(9187),p=t(7921),n=t(1153),l=t.n(n),c=t(9288),d=t.n(c);let g=process.env.SHOPIFY_STORE_URL,m=process.env.SHOPIFY_ACCESS_TOKEN,x=async(e,r)=>{try{let t=r.split(".").pop().toLowerCase();if("webp"===t)return console.log("Image is already in WebP format, skipping conversion."),e;let s=await d()(e).webp({quality:80,lossless:!1,alphaQuality:80,nearLossless:!0}).toBuffer();return s.length>3145728&&(console.log("Image exceeds 3MB. Reducing quality further."),s=await d()(s).webp({quality:60}).toBuffer()),console.log("Image converted and optimized to WebP format."),s}catch(e){throw console.error("Error converting image to WebP:",e.message),e}},f=async(e,r,t)=>{try{let s=`${g}/admin/api/2023-10/products/${e}/images.json`,o=new(l());o.append("image[attachment]",r.toString("base64")),o.append("image[filename]",t);let i=await (0,p.Ay)(s,{method:"POST",headers:{"X-Shopify-Access-Token":m},body:o});if(!i.ok)throw Error(`Failed to upload image: ${i.statusText}`);let a=await i.json();return console.log("Shopify response:",a),a.image||null}catch(e){throw console.error("Error uploading image to Shopify:",e.message),e}},h=async e=>{try{let r=await e.formData(),t={};for(let[e,s]of(console.log("Received form data:",r),r.entries())){let r=e.split("/")[0];console.log(`Processing Product ID: ${r}`);let o=Buffer.from(await s.arrayBuffer());console.log(`Preparing to upload image for Product ID ${r} to Shopify`);let i=await x(o,s.name),a=await f(r,i,s.name);console.log(`Image uploaded successfully: ${a}`),t[r]||(t[r]=[]),t[r].push(a)}return console.log("Folder uploads:",t),u.NextResponse.json({message:"Images uploaded successfully.",folderUploads:t})}catch(e){return console.error("Error during image upload:",e.message),u.NextResponse.json({error:e.message},{status:500})}},q=new o.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/upload/id/route",pathname:"/api/upload/id",filename:"route",bundlePath:"app/api/upload/id/route"},resolvedPagePath:"/Users/ravisharma/bulk-image-uploader/shopify-image-upload/src/app/api/upload/id/route.js",nextConfigOutput:"",userland:s}),{workAsyncStorage:y,workUnitAsyncStorage:w,serverHooks:v}=q;function P(){return(0,a.patchFetch)({workAsyncStorage:y,workUnitAsyncStorage:w})}},6487:()=>{},8335:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[613,452,302,153],()=>t(4604));module.exports=s})();