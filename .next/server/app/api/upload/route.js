(()=>{var e={};e.id=413,e.ids=[413],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},9288:e=>{"use strict";e.exports=require("sharp")},9428:e=>{"use strict";e.exports=require("buffer")},9021:e=>{"use strict";e.exports=require("fs")},1630:e=>{"use strict";e.exports=require("http")},5591:e=>{"use strict";e.exports=require("https")},3873:e=>{"use strict";e.exports=require("path")},7910:e=>{"use strict";e.exports=require("stream")},9551:e=>{"use strict";e.exports=require("url")},8354:e=>{"use strict";e.exports=require("util")},3566:e=>{"use strict";e.exports=require("worker_threads")},4573:e=>{"use strict";e.exports=require("node:buffer")},3024:e=>{"use strict";e.exports=require("node:fs")},7067:e=>{"use strict";e.exports=require("node:http")},4708:e=>{"use strict";e.exports=require("node:https")},7030:e=>{"use strict";e.exports=require("node:net")},6760:e=>{"use strict";e.exports=require("node:path")},1708:e=>{"use strict";e.exports=require("node:process")},7075:e=>{"use strict";e.exports=require("node:stream")},7830:e=>{"use strict";e.exports=require("node:stream/web")},3136:e=>{"use strict";e.exports=require("node:url")},7975:e=>{"use strict";e.exports=require("node:util")},8522:e=>{"use strict";e.exports=require("node:zlib")},6550:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>S,routeModule:()=>y,serverHooks:()=>P,workAsyncStorage:()=>q,workUnitAsyncStorage:()=>v});var o={};t.r(o),t.d(o,{POST:()=>w});var s=t(2706),a=t(8203),i=t(5994),u=t(9187),n=t(7921),p=t(1153),c=t.n(p),l=t(9288),d=t.n(l);let g=process.env.SHOPIFY_STORE_URL,m=process.env.SHOPIFY_ACCESS_TOKEN,f=async e=>{try{let r=`${g}/admin/api/2023-10/products/${e}.json`,t=await (0,n.Ay)(r,{method:"GET",headers:{"X-Shopify-Access-Token":m,"Content-Type":"application/json"}});if(!t.ok)throw Error(`Failed to fetch product: ${t.statusText}`);let o=await t.json();if(!o.product)throw Error(`No product found with ID: ${e}`);return console.log("Product found:",o.product),o.product}catch(e){throw console.error("Error fetching product from Shopify:",e.message),e}},h=async(e,r)=>{try{let t=r.split(".").pop().toLowerCase();if("webp"===t)return console.log("Image is already in WebP format, skipping conversion."),e;let o=await d()(e).webp({quality:80,lossless:!1,alphaQuality:80,nearLossless:!0}).toBuffer();return o.length>3145728&&(console.log("Image exceeds 3MB. Reducing quality further."),o=await d()(o).webp({quality:60}).toBuffer()),console.log("Image converted and optimized to WebP format."),o}catch(e){throw console.error("Error converting image to WebP:",e.message),e}},x=async(e,r,t)=>{try{let o=`${g}/admin/api/2023-10/products/${e}/images.json`,s=new(c());s.append("image[attachment]",r.toString("base64")),s.append("image[filename]",t);let a=await (0,n.Ay)(o,{method:"POST",headers:{"X-Shopify-Access-Token":m},body:s});if(!a.ok)throw Error(`Failed to upload image: ${a.statusText}`);let i=await a.json();return console.log("Shopify response:",i),i.image||null}catch(e){throw console.error("Error uploading image to Shopify:",e.message),e}},w=async e=>{try{let r=await e.formData(),t={};for(let[e,o]of(console.log("Received form data:",r),r.entries())){let r=e.split("/")[0];if(console.log(`Received Product ID: ${r}`),await f(r)){let e=Buffer.from(await o.arrayBuffer());console.log(`Preparing to upload image for Product ID ${r} to Shopify`);let s=await h(e,o.name),a=await x(r,s,o.name);console.log(`Image uploaded successfully: ${a}`),t[r]||(t[r]=[]),t[r].push(a)}else console.log(`No product found for ID: ${r}`)}return console.log("Folder uploads:",t),u.NextResponse.json({message:"Images uploaded successfully.",folderUploads:t})}catch(e){return console.error("Error during image upload:",e.message),u.NextResponse.json({error:e.message},{status:500})}},y=new s.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/upload/route",pathname:"/api/upload",filename:"route",bundlePath:"app/api/upload/route"},resolvedPagePath:"/Users/ravisharma/bulk-image-uploader/shopify-image-upload/src/app/api/upload/route.js",nextConfigOutput:"",userland:o}),{workAsyncStorage:q,workUnitAsyncStorage:v,serverHooks:P}=y;function S(){return(0,i.patchFetch)({workAsyncStorage:q,workUnitAsyncStorage:v})}},6487:()=>{},8335:()=>{}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[613,452,302,153],()=>t(6550));module.exports=o})();